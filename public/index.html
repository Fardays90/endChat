<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <link href="/src/output.css" rel="stylesheet">
    <style>
        body{
            /* 47, 6, 195 */
            background-image: linear-gradient(to bottom right, rgb(0, 0, 0), rgb(25, 156, 125)); 
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
        }
        #name{
            backdrop-filter: blur(10px);
            background-color: rgba(0, 0, 0, 0.235);
        }
        #submit-btn{
            background-color: rgba(255, 255, 255, 0.704);
            backdrop-filter: blur(10px);
        }
        #submit-btn{
            background-color: rgba(255, 255, 255, 0.704);
            backdrop-filter: blur(10px);
        }
        #submit-btn:hover{
            background-color: rgba(8, 130, 143, 0.242);
            backdrop-filter: blur(10px);
        }
        input:focus{
            outline:none;
            border:none;
        }
        #chatBox{
            backdrop-filter: blur(10px);
            z-index:0;
            background-color: rgba(41, 228, 207, 0.276);
        }
        #usernameDiv{
            backdrop-filter: blur(10px);
            z-index:0;
            background-color: rgba(41, 228, 207, 0.276);
        }
        #send{
            background-color: rgb(255, 255, 255);
            backdrop-filter: blur(10px);
        }
        #send:hover{
            background-color: rgba(0, 0, 0, 0.849);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body> 
    <div class="h-40 space-y-10" id="nameDiv">
        <h1 class="text-white text-4xl font-extralight text-center mt-28" style="z-index: 9999;">Welcome to the end</h1>
        <form class="flex flex-col w-96  mx-auto space-y-5" id="nameForm">
            <input class="text-center  text-white  p-5  rounded-xl"  required  type="text" spellcheck="false" autocomplete="off" id="name" placeholder="Enter your name">
            <button  style="z-index: 9999;" class="p-3 w-24 self-center rounded-xl hover:scale-110 transition-all duration-300 text-center  hover:text-white" id="submit-btn" type="submit">Confirm</button>
        </form>
    </div>
    <div id="chat" class="flex justify-between p-5 flex-row w-full ">
        <div class="flex rounded-xl  text-white justify-between p-3 w-[50vw] h-[75vh] flex-col" id="chatBox" >
            <div class="overflow-auto" id="messages"></div>
            <form class="sticky flex flex-row justify-between text-black border-t-2 border-white  p-3" id="form">
                <input id="input" class="bg-transparent text-white" autocomplete="off" placeholder="Type a message..." />
                <button class="p-3 transition-all duration-300 hover:text-white hover:scale-110 rounded-xl" id="send">Send</button>
            </form>
        </div>
        <div id="usernameDiv" class="rounded-xl text-white w-72 p-5 h-72 justify-end">
            <h1 class="text-center">Active users currently</h1>
            <div id="usersDiv" class="">
            <!-- pop wit js -->
            </div>
        </div>
  </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const nameForm = document.getElementById('nameForm');
        const submitName = document.getElementById('submit-btn');
        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const nameInput = document.getElementById('name');
        const messages = document.getElementById('messages');
        const userNameBox = document.getElementById('usersDiv');
        let userName;
        nameInput.addEventListener('invalid', (event) => {
            event.preventDefault();
            nameInput.classList.add('border-4', 'border-red-500'); // Tailwind class for red border
        });

        // Remove highlight on input
        nameInput.addEventListener('input', () => {
            nameInput.classList.remove('border-4', 'border-red-500');
        });
        nameForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const userInput = document.getElementById('name').value.trim();
            if(userInput){
                nameInput.setCustomValidity('');
                event.preventDefault(); 
                userName = document.getElementById('name').value;
                document.getElementById('chat').style.display = '';
                document.getElementById('nameDiv').style.display = 'none';
                console.log(userName);
                socket.emit('username', userName);
            }
        })

        // Listen for form submission
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const message = input.value.trim();
            if (message) {
                socket.emit('chatMessage', message); // Send message to the server
                input.value = ''; // Clear input field
            }
        });
        socket.on('activeUsers', (usernames) => {
            userNameBox.innerHTML = '';
            for(let i = 0; i < usernames.length; i++){
                userP = document.createElement('p');
                userP.textContent = usernames[i];
                userNameBox.appendChild(userP);
            }
        })
        socket.on('chatMessage', ({userName, msg}) => {
            const item = document.createElement('div');
            item.textContent =userName+": " +  msg;
            messages.appendChild(item);
            messages.scrollTop = messages.scrollHeight; // Auto-scroll to the latest message
        });

        socket.on('userJoined', (str) => {
            const item = document.createElement('p');
            item.textContent = str;
            messages.appendChild(item);
        })
        socket.on('userDis', ({userName, leavingMsg}) => {
            const item = document.createElement('p');
            item.textContent = leavingMsg;
            messages.appendChild(item);
        })


        document.body.appendChild(dmForm);
        document.getElementById('dm-form').addEventListener('submit', (event) => {
            event.preventDefault();
            const sendingTo = document.getElementById('recipient').value;
            const message = document.getElementById('dm-input').value;
            if(sendingTo && message){
                socket.emit('dm', {personToSend:sendingTo , msg:message});
                document.getElementById('dm-input').value = '';
            }
        })
        socket.on('dm', ({from, msg}) => {
            const item = document.createElement('div');
            item.textContent = `DM from ${from}: ${msg}`;
            messages.appendChild(item);
        })
    </script>
</body>
</html>
