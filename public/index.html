<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <link href="/src/output.css" rel="stylesheet">
    <style>
        #chat { margin: 10px auto; width: 90%; max-width: 600px; }
        #messages { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; }
        #form { display: flex; margin-top: 10px; }
        #input { flex: 1; padding: 10px; font-size: 16px; }
        #send { padding: 10px 20px; font-size: 16px; }
        body{
            background-image: linear-gradient(to bottom right, rgb(0, 0, 0), rgb(25, 156, 125));
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
        }
        #name{
            backdrop-filter: blur(10px);
            background-color: rgba(0, 0, 0, 0.235);
        }
        #submit-btn{
            background-color: rgba(255, 255, 255, 0.704);
            backdrop-filter: blur(10px);
        }
        #submit-btn{
            background-color: rgba(255, 255, 255, 0.704);
            backdrop-filter: blur(10px);
        }
        #submit-btn:hover{
            background-color: rgba(8, 130, 143, 0.242);
            backdrop-filter: blur(10px);
        }
        input:focus{
            outline:none;
            border:none;
        }
    </style>
</head>
<body>
    
    <div class="h-40 space-y-10" id="nameDiv">
        <h1 class="text-white text-4xl font-extralight text-center mt-28" style="z-index: 9999;">Welcome to the end</h1>
        <form class="flex flex-col w-96  mx-auto space-y-5" id="nameForm">
            <input class="text-center  text-white  p-5  rounded-xl"  required  type="text" spellcheck="false" autocomplete="off" id="name" placeholder="Enter your name">
            <button class="p-3 w-24 self-center rounded-xl hover:scale-110 transition-all duration-300 text-center  hover:text-white" id="submit-btn" type="submit">Confirm</button>
        </form>
    </div>
    <div style="display:none" class=" bg-white" id="chat">
        <div>
    
        <div id="messages"></div>
        </div>
        <form id="form">
            <input id="input" autocomplete="off" placeholder="Type a message..." />
            <button id="send">Send</button>
        </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const nameForm = document.getElementById('nameForm');
        const submitName = document.getElementById('submit-btn');
        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const nameInput = document.getElementById('name');
        const messages = document.getElementById('messages');
        let userName;
        nameInput.addEventListener('invalid', (event) => {
            event.preventDefault();
            nameInput.classList.add('border-4', 'border-red-500'); // Tailwind class for red border
        });

        // Remove highlight on input
        nameInput.addEventListener('input', () => {
            nameInput.classList.remove('border-4', 'border-red-500');
        });
        nameForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const userInput = document.getElementById('name').value.trim();
            if(userInput){
                nameInput.setCustomValidity('');
                event.preventDefault(); 
                userName = document.getElementById('name').value;
                document.getElementById('chat').style.display = '';
                document.getElementById('nameDiv').style.display = 'none';
                console.log(userName);
                socket.emit('username', userName);
            }
        })

        // Listen for form submission
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const message = input.value.trim();
            if (message) {
                socket.emit('chatMessage', message); // Send message to the server
                input.value = ''; // Clear input field
            }
        });
         
            
        socket.on('chatMessage', ({userName, msg}) => {
            const item = document.createElement('div');
            item.textContent =userName+": " +  msg;
            messages.appendChild(item);
            messages.scrollTop = messages.scrollHeight; // Auto-scroll to the latest message
        });

        socket.on('userJoined', (str) => {
            const item = document.createElement('p');
            item.textContent = str;
            messages.appendChild(item);
        })
        socket.on('userDis', (str) => {
            const item = document.createElement('p');
            item.textContent = str;
            messages.appendChild(item);
        })


        const dmForm = document.createElement('form');
        dmForm.id = 'dm-form';
        dmForm.innerHTML = 
        ` <input id="recipient" placeholder="Recipient's username" />
            <input id="dm-input" placeholder="Type a direct message..." />
            <button type="submit">Send DM</button>`
        document.body.appendChild(dmForm);
        document.getElementById('dm-form').addEventListener('submit', (event) => {
            event.preventDefault();
            const sendingTo = document.getElementById('recipient').value;
            const message = document.getElementById('dm-input').value;
            if(sendingTo && message){
                socket.emit('dm', {personToSend:sendingTo , msg:message});
                document.getElementById('dm-input').value = '';
            }
        })
        socket.on('dm', ({from, msg}) => {
            const item = document.createElement('div');
            item.textContent = `DM from ${from}: ${msg}`;
            messages.appendChild(item);
        })
    </script>
</body>
</html>
